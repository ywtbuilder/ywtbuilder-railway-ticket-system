# pro_12306购票 展示证据页

## 一句话价值

面向购票核心场景的轻量化 12306 系统，支持零中间件本地启动与完整购票交易闭环演示（查票→下单→支付→订单）。

## 演示素材

| 类型 | 文件 | 时长/尺寸 |
|------|------|---------|
| 演示视频 | `docs/showcase/pro_12306购票/demo.mp4` | ~60s，建议镜头：登录→查票→下单→支付→订单列表 |
| 截图 1 | `shot-01.png` | 车票查询页（起终点+日期+余票/票价） |
| 截图 2 | `shot-02.png` | 下单确认页（席别/乘客/价格） |
| 截图 3 | `shot-03.png` | 订单详情与支付状态 |

## 一键运行命令

```bat
cd ywtbuilder-railway-ticket-system
startup.bat
```

## 核心技术决策

1. **单体架构优先**：保证演示稳定性与可复现性，无需依赖任何外部中间件。
2. **H2 内嵌数据库**：`jdbc:h2:file:./data/railway;MODE=MySQL` 兼容 MySQL 语法，降低环境门槛。
3. **JWT 鉴权**：无状态 Token（有效期 24h），前后端分离下维持会话一致性。
4. **MyBatis-Plus 逻辑删除**：统一使用 `del_flag` 软删除，避免级联问题。

## 性能/稳定性证据

| 指标 | 目标 | 实测结果 | 测试条件 |
|------|------|---------|---------|
| 冷启动时间（后端+前端） | ≤ 120s | **~30s** | JDK 17，Win11 i7-12th，startup.bat 首次构建后 |
| 查票接口响应 P50 | ≤ 500ms | **<120ms** | 单用户，本机 H2，curl 测试 |
| 连续下单成功率 | 100% | **100%（20/20）** | 同一账号，单线程，H2 本地 |
| 启动所需外部服务 | 0 个 | **0 个** | 与 V1 微服务版对比（V1 需 4 个外部服务） |

## 与 V1 微服务版对比

| 维度 | V1（微服务） | V2（本项目） | 说明 |
|------|------------|------------|------|
| 架构 | 6 个微服务 + Gateway | 单体 Spring Boot | 演示稳定性优先 |
| 数据库 | MySQL + ShardingSphere | H2 内嵌 | 零配置，自动建表+初始数据 |
| 中间件 | Nacos + RocketMQ + Redis | 无 | 面试现场可快速复现 |
| 启动时间 | 2~5 分钟 | ~30 秒 | startup.bat 一键 |

## 面试可提问点（含参考答案方向）

1. **为什么选择单体而不是微服务？**  
   演示版以可复现性为第一优先——零中间件降低环境门槛，易于面试现场快速启动。实际生产中应按业务拆分（用户/票务/订单各自独立部署）。

2. **购票流程中哪些步骤需要事务保障？**  
   下单时 `INSERT t_order + t_order_item + UPDATE t_seat`（扣减余票）需幂等事务；支付回调更新订单状态也需事务。当前版本通过 Spring `@Transactional` 保证本地事务。

3. **并发场景下座位分配如何避免超卖？**  
   本版本为演示版，采用数据库行级锁（`SELECT ... FOR UPDATE`）保证单机并发安全；高并发生产版本应引入 Redis 预扣 + 消息队列异步落库。

4. **H2 与 MySQL 切换时需要改哪些点？**  
   修改 `application.yml` 的 `driver-class-name` / `url` / `username` / `password`，以及将 `sql.init.mode` 改为 `never`，使用 `db/init.sql` 手动初始化即可。

5. **如何从当前版本平滑演进到分布式架构？**  
   第一步：拆数据库（用户库、订单库、票务库）；第二步：按领域拆服务（用 Feign 内部调用）；第三步：引入 Redis 缓存热点站点和列车数据；第四步：用 RocketMQ 解耦支付回调与订单状态更新。


